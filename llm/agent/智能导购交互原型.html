<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µå•†å¯¼è´­AIåŠ©æ‰‹ - äº¤äº’åŸå‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, sans-serif;
        }
        
        body {
            background-color: #f5f5f7;
            color: #1d1d1f;
            line-height: 1.5;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e5e7;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            color: #1d1d1f;
        }
        
        .header p {
            color: #86868b;
            font-size: 16px;
        }
        
        .container {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .demo-area {
            flex: 1;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 20px;
            background-color: #fbfbfd;
            border-bottom: 1px solid #e5e5e7;
        }
        
        .chat-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .new-chat-btn {
            background-color: #007aff;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .new-chat-btn:hover {
            background-color: #0056cc;
        }
        
        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            height: 500px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .message {
            display: flex;
            gap: 12px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.user {
            flex-direction: row-reverse;
        }
        
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .user .avatar {
            background-color: #007aff;
            color: white;
        }
        
        .assistant .avatar {
            background-color: #34c759;
            color: white;
        }
        
        .message-content {
            max-width: 70%;
        }
        
        .user .message-content {
            align-items: flex-end;
        }
        
        .message-text {
            padding: 14px 18px;
            border-radius: 18px;
            font-size: 15px;
            line-height: 1.5;
            margin-bottom: 8px;
        }
        
        .user .message-text {
            background-color: #007aff;
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .assistant .message-text {
            background-color: #f2f2f7;
            color: #1d1d1f;
            border-bottom-left-radius: 4px;
        }
        
        /* æ€è€ƒä¸­çŠ¶æ€ */
        .thinking-indicator {
            color: #8e8e93;
            font-style: italic;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .thinking-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #8e8e93;
            animation: thinkingPulse 1.5s infinite ease-in-out;
        }
        
        .thinking-dot:nth-child(1) { animation-delay: -0.32s; }
        .thinking-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes thinkingPulse {
            0%, 100% { opacity: 0.4; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1); }
        }
        
        /* åœæ­¢ç”Ÿæˆæç¤º */
        .stop-hint {
            color: #8e8e93;
            font-style: italic;
            border-left: 3px solid #34c759;
            padding-left: 10px;
        }
        
        /* å•†å“æ¨èåŒºåŸŸæ ·å¼ */
        .product-recommendations {
            margin-top: 15px;
            width: 100%;
        }
        
        .recommendation-title {
            font-size: 15px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .recommendation-title::before {
            content: "ğŸ";
            font-size: 16px;
        }
        
        .product-cards-container {
            position: relative;
            width: 100%;
            overflow-x: hidden;
            border-radius: 12px;
            min-height: 220px;
        }
        
        .product-cards-track {
            display: flex;
            gap: 15px;
            transition: transform 0.3s ease;
            padding: 5px 0;
            min-height: 220px;
        }
        
        .product-card {
            flex: 0 0 auto;
            width: 200px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            border: 1px solid #e5e5e7;
            transition: transform 0.2s, box-shadow 0.2s;
            opacity: 0;
            transform: translateY(10px);
            animation: cardAppear 0.5s ease forwards;
        }
        
        .product-card:nth-child(1) { animation-delay: 0.1s; }
        .product-card:nth-child(2) { animation-delay: 0.2s; }
        .product-card:nth-child(3) { animation-delay: 0.3s; }
        .product-card:nth-child(4) { animation-delay: 0.4s; }
        .product-card:nth-child(5) { animation-delay: 0.5s; }
        
        @keyframes cardAppear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .product-image {
            width: 100%;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            position: relative;
            overflow: hidden;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .product-image::after {
            content: "å•†å“å›¾ç‰‡";
            position: absolute;
        }
        
        .product-info {
            padding: 15px;
        }
        
        .product-title {
            font-size: 15px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 8px;
            line-height: 1.4;
            height: 42px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .product-reason {
            font-size: 13px;
            color: #515154;
            margin-bottom: 10px;
            line-height: 1.4;
            height: 36px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .product-price {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 5px;
        }
        
        .price {
            font-size: 18px;
            font-weight: 700;
            color: #ff3b30;
        }
        
        .price::before {
            content: "Â¥";
            font-size: 14px;
            margin-right: 2px;
        }
        
        .buy-btn {
            background-color: #007aff;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 13px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .buy-btn:hover {
            background-color: #0056cc;
        }
        
        /* é—®é¢˜æ¨èåŒºåŸŸæ ·å¼ */
        .question-recommendations {
            margin-top: 20px;
            width: 100%;
        }
        
        .question-title {
            font-size: 15px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .question-title::before {
            content: "ğŸ’¡";
            font-size: 16px;
        }
        
        .question-chips-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .question-chip {
            background-color: #f2f2f7;
            border: 1px solid #e5e5e7;
            border-radius: 18px;
            padding: 10px 18px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            color: #1d1d1f;
            max-width: 100%;
            word-break: break-word;
        }
        
        .question-chip:hover {
            background-color: #007aff;
            color: white;
            border-color: #007aff;
            transform: translateY(-2px);
        }
        
        /* æ»‘åŠ¨æŒ‰é’® */
        .scroll-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: background-color 0.2s;
            opacity: 0;
        }
        
        .product-cards-container:hover .scroll-btn {
            opacity: 1;
        }
        
        .scroll-btn:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }
        
        .scroll-btn.left {
            left: 10px;
        }
        
        .scroll-btn.right {
            right: 10px;
        }
        
        /* æ»‘åŠ¨æŒ‡ç¤ºå™¨ */
        .scroll-indicator {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 12px;
        }
        
        .indicator-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #d1d1d6;
            transition: background-color 0.3s;
        }
        
        .indicator-dot.active {
            background-color: #007aff;
            transform: scale(1.2);
        }
        
        .feedback-buttons {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .feedback-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid #d1d1d6;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .feedback-btn.active {
            background-color: #34c759;
            color: white;
            border-color: #34c759;
        }
        
        .feedback-btn.dislike.active {
            background-color: #ff3b30;
            border-color: #ff3b30;
        }
        
        .typing-indicator {
            display: flex;
            gap: 6px;
            padding: 12px 0;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #8e8e93;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        .input-area {
            padding: 20px;
            border-top: 1px solid #e5e5e7;
            background-color: #fbfbfd;
        }
        
        .stop-btn {
            width: 100%;
            background-color: #ff3b30;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            display: none;
        }
        
        .stop-btn.show {
            display: block;
        }
        
        .suggested-questions {
            margin-bottom: 15px;
        }
        
        .suggest-title {
            font-size: 14px;
            color: #8e8e93;
            margin-bottom: 10px;
        }
        
        .question-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .input-container {
            display: flex;
            gap: 12px;
        }
        
        .chat-input {
            flex: 1;
            padding: 14px 18px;
            border: 1px solid #d1d1d6;
            border-radius: 12px;
            font-size: 15px;
            resize: none;
            min-height: 52px;
            max-height: 120px;
            overflow-y: auto;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #007aff;
        }
        
        .send-btn {
            background-color: #007aff;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 0 24px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            align-self: flex-end;
            height: 52px;
        }
        
        .send-btn:hover {
            background-color: #0056cc;
        }
        
        .send-btn:disabled {
            background-color: #c7c7cc;
            cursor: not-allowed;
        }
        
        .api-docs {
            flex: 1;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 24px;
            overflow-y: auto;
            max-height: 600px;
        }
        
        .api-docs h2 {
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e5e5e7;
        }
        
        .api-section {
            margin-bottom: 24px;
        }
        
        .api-section h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #007aff;
        }
        
        .api-section p {
            margin-bottom: 12px;
            font-size: 14px;
            color: #515154;
        }
        
        .code-block {
            background-color: #f5f5f7;
            border-radius: 8px;
            padding: 16px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            line-height: 1.5;
            overflow-x: auto;
            margin-bottom: 16px;
        }
        
        .endpoint {
            display: inline-block;
            background-color: #007aff;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 8px;
        }
        
        .endpoint.get { background-color: #34c759; }
        .endpoint.post { background-color: #007aff; }
        
        .params-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin-top: 12px;
        }
        
        .params-table th, .params-table td {
            border: 1px solid #e5e5e7;
            padding: 10px;
            text-align: left;
        }
        
        .params-table th {
            background-color: #f5f5f7;
            font-weight: 600;
        }
        
        .status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status.streaming {
            background-color: #ffcc00;
            color: #1d1d1f;
        }
        
        .status.typing {
            background-color: #007aff;
            color: white;
        }
        
        .status.idle {
            background-color: #34c759;
            color: white;
        }
        
        .api-note {
            background-color: #fff8e1;
            border-left: 4px solid #ffcc00;
            padding: 12px 16px;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .footer {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #e5e5e7;
            color: #86868b;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .api-docs {
                max-height: 400px;
            }
            
            .product-card {
                width: 180px;
            }
            
            .message-content {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ç”µå•†å¯¼è´­AIåŠ©æ‰‹ - äº¤äº’åŸå‹</h1>
    </div>
    
    <div class="container">
        <div class="demo-area">
            <div class="chat-header">
                <div class="chat-title">ä¸‰ç¦æ™ºèƒ½å¯¼è´­åŠ©æ‰‹</div>
                <div>
                    <span class="status idle" id="statusIndicator">å‡†å¤‡å°±ç»ª</span>
                    <button class="new-chat-btn" id="newChatBtn">æ–°å¯¹è¯</button>
                </div>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                <!-- æ¶ˆæ¯ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                <div class="message assistant">
                    <div class="avatar">AI</div>
                    <div class="message-content">
                        <div class="message-text">ä½ å¥½å‘€ï¼Œæˆ‘æ˜¯æ‚¨çš„ä¸‰ç¦å¯¼è´­å°å¸®æ‰‹ï¼Œä¸“æ³¨äºå¸®åŠ©æ‚¨å¿«é€Ÿæ‰¾åˆ°å¿ƒä»ªçš„å•†å“ï¼ŒåŒæ—¶æä¾›ä¸ªæ€§åŒ–çš„æ¨èå’Œè½»æ¾æ„‰å¿«çš„äº¤æµã€‚æ— è®ºæ‚¨æ˜¯åœ¨å¯»æ‰¾ç‰¹å®šäº§å“ï¼Œè¿˜æ˜¯éœ€è¦ä¸€äº›é—²é€›è´­ç‰©çš„å»ºè®®ï¼Œæˆ‘éƒ½ä¼šåŠªåŠ›æä¾›æœ€ç›¸å…³å’Œå®ç”¨çš„ä¿¡æ¯ã€‚ä¸è®ºæ‚¨æœ‰ä»€ä¹ˆè¦æ±‚æˆ–é—®é¢˜ï¼Œéƒ½æ¬¢è¿éšæ—¶æé—®ï¼</div>
                        <div class="feedback-buttons">
                            <button class="feedback-btn" data-rating="like">ğŸ‘</button>
                            <button class="feedback-btn dislike" data-rating="dislike">ğŸ‘</button>
                        </div>
                    </div>
                </div>
                
                <div class="typing-indicator" id="typingIndicator" style="display: none;">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            
            <div class="input-area">
                <button class="stop-btn" id="stopBtn">åœæ­¢ç”Ÿæˆ</button>
                
                <div class="suggested-questions" id="suggestedQuestions">
                    <div class="suggest-title">è¯•è¯•é—®æˆ‘ï¼š</div>
                    <div class="question-chips">
                        <div class="question-chip">å¤å­£è¿è¡£è£™æ¨è</div>
						<div class="question-chip">æ¨èè¿åŠ¨è€³æœº</div>
                        <div class="question-chip">é€‚åˆé€ç”·å‹çš„ç¤¼ç‰©</div>
                        <div class="question-chip">æ€§ä»·æ¯”é«˜çš„ç¬”è®°æœ¬ç”µè„‘</div>
                    </div>
                </div>
                
                <div class="input-container">
                    <textarea class="chat-input" id="chatInput" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜ï¼Œå¦‚ï¼šæ¨èé€‚åˆè·‘æ­¥çš„è¿åŠ¨é‹..."></textarea>
                    <button class="send-btn" id="sendBtn" disabled>å‘é€</button>
                </div>
            </div>
        </div>
        
        <div class="api-docs">
            <h2>APIæ¥å£è¯´æ˜</h2>
			
			
			<div class="api-section">
                <h3>1. å¼€åœºç™½</h3>
                <p><span class="endpoint post">POST</span> /v1/opening_statement</p>
				<p>ç”¨æˆ·è¿›å…¥å¯¹è¯ç•Œé¢å¼€åœºç™½/æ¬¢è¿è¯­</p>
                
                <div class="code-block">
// åŠŸèƒ½è¯´æ˜ï¼š
1. å¯¹è¯æ¡†å±•ç¤ºè·å–çš„å¼€åœºç™½æ–‡æœ¬ï¼Œå¦‚ï¼š"ä½ å¥½å‘€ï¼Œæˆ‘æ˜¯æ‚¨çš„ä¸‰ç¦å¯¼è´­å°å¸®æ‰‹ï¼Œä¸“æ³¨äºå¸®åŠ©æ‚¨å¿«é€Ÿæ‰¾åˆ°å¿ƒä»ªçš„å•†å“ï¼ŒåŒæ—¶æä¾›ä¸ªæ€§åŒ–çš„æ¨èå’Œè½»æ¾æ„‰å¿«çš„äº¤æµã€‚æ— è®ºæ‚¨æ˜¯åœ¨å¯»æ‰¾ç‰¹å®šäº§å“ï¼Œè¿˜æ˜¯éœ€è¦ä¸€äº›é—²é€›è´­ç‰©çš„å»ºè®®ï¼Œæˆ‘éƒ½ä¼šåŠªåŠ›æä¾›æœ€ç›¸å…³å’Œå®ç”¨çš„ä¿¡æ¯ã€‚ä¸è®ºæ‚¨æœ‰ä»€ä¹ˆè¦æ±‚æˆ–é—®é¢˜ï¼Œéƒ½æ¬¢è¿éšæ—¶æé—®ï¼"
                </div>
            </div>
			
			
			<div class="api-section">
                <h3>2. è¯•è¯•é—®</h3>
                <p><span class="endpoint post">POST</span> /v1/try_to_ask</p>
				<p>ç”¨æˆ·è¿›å…¥å¯¹è¯ç•Œé¢æç¤ºâ€œè¯•è¯•é—®æˆ‘â€</p>
                
                <div class="code-block">
// åŠŸèƒ½è¯´æ˜ï¼š
1. ç»“åˆç”¨æˆ·è¡Œä¸ºåºåˆ—ã€ä¸ªæ€§åŒ–åå¥½ç­‰ä¿¡æ¯ï¼Œæ¨èç”¨æˆ·å¯èƒ½æ„Ÿå…´è¶£çš„é—®é¢˜ï¼Œå±•ç¤ºâ€œè¯•è¯•é—®æˆ‘â€ï¼Œå¦‚ï¼š["æµ·è¾¹åº¦å‡", "ç‰›ä»”è£¤", "åœ£è¯ç¤¼ç‰©"]
                </div>
            </div>
			
            
            <div class="api-section">
                <h3>3. å‘é€å¯¹è¯æ¶ˆæ¯ï¼ˆæµå¼ï¼‰</h3>
                <p><span class="endpoint post">POST</span> /v1/chat_messages</p>
                <p>å‘é€ç”¨æˆ·æ¶ˆæ¯å¹¶æ¥æ”¶AIçš„æµå¼å“åº”</p>
                
                <div class="code-block">
// è¯·æ±‚ç¤ºä¾‹
{
  "inputs": {},
  "query": "ç”¨æˆ·é—®é¢˜",
  "response_mode": "streaming",
  "conversation_id": "å¯é€‰ï¼Œä¸ºç©ºè¡¨ç¤ºæ–°å¯¹è¯",
  "user": "ç”¨æˆ·å”¯ä¸€æ ‡è¯†"
}

// æµå¼å“åº”ç¤ºä¾‹
data: {"event": "message", "task_id": "xxx", "id": "yyy", "answer": "Hi", "created_at": 1705398420}\n\n
                </div>
                
                <table class="params-table">
                    <tr>
                        <th>å‚æ•°</th>
                        <th>ç±»å‹</th>
                        <th>è¯´æ˜</th>
                    </tr>
                    <tr>
                        <td>response_mode</td>
                        <td>string</td>
                        <td>å¿…é¡»è®¾ç½®ä¸º"streaming"</td>
                    </tr>
                    <tr>
                        <td>conversation_id</td>
                        <td>string</td>
                        <td>å¯¹è¯IDï¼Œç©ºå­—ç¬¦ä¸²è¡¨ç¤ºæ–°å¯¹è¯</td>
                    </tr>
                    <tr>
                        <td>user</td>
                        <td>string</td>
                        <td>ç”¨æˆ·å”¯ä¸€æ ‡è¯†</td>
                    </tr>
                </table>
            </div>
            
            <div class="api-section">
                <h3>4. å•†å“æ¨è</h3>
                <p><span class="endpoint post">æ‰©å±•</span> åœ¨AIå›å¤åè¿”å›å•†å“æ¨èæ•°æ®</p>
                
                <div class="code-block">
// å•†å“æ¨èæ•°æ®ç¤ºä¾‹ï¼ˆAPIæ‰©å±•è¿”å›ï¼‰
{
  "recommendations": [
    {
      "id": "prod_001",
      "title": "ç´¢å°¼WF-1000XM4æ— çº¿é™å™ªè€³æœº",
      "reason": "IPX4é˜²æ°´ï¼Œé™å™ªæ•ˆæœå‡ºè‰²ï¼Œé€‚åˆè¿åŠ¨æ—¶ä½©æˆ´",
      "price": 1599,
      "image_url": "https://example.com/image1.jpg",
      "product_url": "https://example.com/product/001"
    }
  ],
  "related_questions": [
    "è¿™æ¬¾è€³æœºç»­èˆªæ—¶é—´å¤šä¹…ï¼Ÿ",
    "æœ‰å“ªå‡ ç§é¢œè‰²å¯ä»¥é€‰æ‹©ï¼Ÿ",
    "é€‚åˆè·‘æ­¥æ—¶ä½©æˆ´å—ï¼Ÿ"
  ]
}
                </div>
            </div>
            
            <div class="api-section">
                <h3>5. ä¸‹ä¸€è½®é—®é¢˜æ¨è</h3>
                <p><span class="endpoint post">æ‰©å±•</span> åœ¨AIå›å¤åå±•ç¤ºè¿˜å¯ä»¥çš„æ¨èé—®é¢˜</p>
                
                <div class="code-block">
// åŠŸèƒ½è¯´æ˜ï¼š
1. åœ¨å•†å“æ¨èä¹‹åå±•ç¤º"æ‚¨è¿˜å¯ä»¥é—®æˆ‘è¿™äº›é—®é¢˜"
2. å±•ç¤º3-5ä¸ªç›¸å…³çš„é—®é¢˜æ¨è
3. ç‚¹å‡»é—®é¢˜æ¨èè‡ªåŠ¨å‘é€æ¶ˆæ¯
4. å¢å¼ºç”¨æˆ·äº¤äº’ä½“éªŒï¼Œå¼•å¯¼å¯¹è¯ç»§ç»­

// äº¤äº’æµç¨‹ï¼š
1. AIå›å¤ â†’ 2. å•†å“æ¨è â†’ 3. é—®é¢˜æ¨è â†’ 4. ç”¨æˆ·ç‚¹å‡»é—®é¢˜ â†’ 5. ç»§ç»­å¯¹è¯
                </div>
            </div>
			
			<div class="api-section">
                <h3>6. åœæ­¢å›å¤</h3>
                <p><span class="endpoint post">POST</span> /chat-messages/:task_id/stop</p>
				<p>åœ¨AIå›å¤æ—¶åœæ­¢ç”Ÿæˆ</p>
                
                <div class="code-block">
// åŠŸèƒ½è¯´æ˜ï¼š
1. å¯¹è¯æ¡†å±•ç¤ºå›ºå®šæ–‡æœ¬ï¼š"å¥½çš„ï¼Œé‚£å…ˆä¸è§£ç­”äº†ï¼Œä½ å¯ä»¥ç»§ç»­å‘æˆ‘æé—®å“¦"
                </div>
            </div>
			
			
			<div class="api-section">
                <h3>7. æ–°å¯¹è¯</h3>
                <p><span class="endpoint post">æ‰©å±•</span> åˆ›å»ºæ–°çš„å¯¹è¯æ ‡è¯†conversion_id</p>
                
                <div class="code-block">
// åŠŸèƒ½è¯´æ˜ï¼š
1. conversion_idé‡ç½®ã€‚Difyæ¥å£å®ç°ä¸ºconversion_idè®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²
                </div>
            </div>
            
            <div class="api-note">
                <strong>æ¥å£è¯´æ˜ï¼š</strong>æ‰€æœ‰APIè¯·æ±‚éƒ½éœ€è¦åœ¨Headerä¸­æ·»åŠ Authorization: Bearer {api_key}è¿›è¡Œèº«ä»½éªŒè¯ã€‚
            </div>
        </div>
    </div>
				
    
    <div class="footer">
        <p>ç”µå•†å¯¼è´­äº¤äº’åŸå‹ v1.4 | å®é™…å®ç°è¯·å‚è€ƒAPIæ–‡æ¡£</p>
    </div>
    
    <script>
        // å•†å“æ•°æ®
        const productData = {
            "è¿åŠ¨è€³æœº": [
                {
                    id: "prod_001",
                    title: "ç´¢å°¼WF-1000XM4æ— çº¿é™å™ªè€³æœº",
                    reason: "IPX4é˜²æ°´ç­‰çº§ï¼Œé™å™ªæ•ˆæœå‡ºè‰²ï¼Œé€‚åˆè¿åŠ¨æ—¶ä½©æˆ´ï¼Œç”µæ± ç»­èˆªé•¿è¾¾24å°æ—¶",
                    price: 1599,
                    image_color: "#3498db"
                },
                {
                    id: "prod_002",
                    title: "Beats Fit ProçœŸæ— çº¿è€³æœº",
                    reason: "è€³ç¿¼è®¾è®¡ç¨³å›ºä¸æ˜“è„±è½ï¼ŒéŸ³è´¨å‡ºä¼—ï¼Œé˜²æ°´é˜²æ±—ï¼Œè‹¹æœH1èŠ¯ç‰‡",
                    price: 1399,
                    image_color: "#e74c3c"
                },
                {
                    id: "prod_003",
                    title: "Jabra Elite 7 Activeè¿åŠ¨è€³æœº",
                    reason: "è¶…è½»è®¾è®¡ä»…5.4å…‹ï¼ŒIP57é˜²å°˜é˜²æ°´ï¼Œ4éº¦å…‹é£é™å™ªï¼Œç»­èˆª30å°æ—¶",
                    price: 1199,
                    image_color: "#2ecc71"
                }
            ],
            "å¤å­£è¿è¡£è£™": [
                {
                    id: "prod_101",
                    title: "æ³•å¼å¤å¤ç¢èŠ±è¿è¡£è£™",
                    reason: "100%æ£‰è´¨é¢æ–™ï¼Œé€æ°”èˆ’é€‚ï¼Œæ”¶è…°è®¾è®¡æ˜¾ç˜¦ï¼Œé€‚åˆå¤šç§åœºåˆ",
                    price: 299,
                    image_color: "#ff9ff3"
                },
                {
                    id: "prod_102",
                    title: "ç®€çº¦çº¯è‰²è¡¬è¡«è¿è¡£è£™",
                    reason: "èŒåœºä¼‘é—²ä¸¤ç›¸å®œï¼Œå‚æ„Ÿé¢æ–™ï¼Œç»å…¸è…°å¸¦è®¾è®¡ï¼Œä¼˜é›…å¤§æ–¹",
                    price: 359,
                    image_color: "#54a0ff"
                },
                {
                    id: "prod_103",
                    title: "æ³¢è¥¿ç±³äºšé•¿æ¬¾æ²™æ»©è£™",
                    reason: "é›ªçººæè´¨è½»ç›ˆé£˜é€¸ï¼ŒVé¢†è®¾è®¡ï¼Œé€‚åˆåº¦å‡æ—…è¡Œæ‹ç…§",
                    price: 269,
                    image_color: "#00d2d3"
                }
            ],
            "ç”·å‹ç¤¼ç‰©": [
                {
                    id: "prod_201",
                    title: "Apple Watch Series 8",
                    reason: "å¥åº·ç›‘æµ‹å…¨é¢ï¼Œè¿åŠ¨åŠŸèƒ½ä¸°å¯Œï¼Œç§‘æŠ€æ„Ÿåè¶³ï¼Œå®ç”¨åˆæ—¶å°š",
                    price: 2999,
                    image_color: "#1d1d1f"
                },
                {
                    id: "prod_202",
                    title: "Bose QuietComfort 45è€³æœº",
                    reason: "é¡¶çº§é™å™ªæ•ˆæœï¼ŒéŸ³è´¨å‡ºè‰²ï¼Œé€‚åˆé€šå‹¤å’Œæ—…è¡Œï¼Œæå‡ç”Ÿæ´»å“è´¨",
                    price: 2299,
                    image_color: "#222f3e"
                },
                {
                    id: "prod_203",
                    title: "é£åˆ©æµ¦9000ç³»åˆ—å‰ƒé¡»åˆ€",
                    reason: "SkinIQæŠ€æœ¯ï¼Œæ™ºèƒ½æ„Ÿåº”ï¼Œå¹²æ¹¿ä¸¤ç”¨ï¼Œé€ç¤¼ä½“é¢åˆå®ç”¨",
                    price: 1499,
                    image_color: "#0066cc"
                }
            ],
            "ç¬”è®°æœ¬ç”µè„‘": [
                {
                    id: "prod_301",
                    title: "è”æƒ³å°æ–°Pro14 2023",
                    reason: "2.8K 120Hzé«˜åˆ·å±ï¼ŒRTX3050æ˜¾å¡ï¼Œæ€§ä»·æ¯”æé«˜çš„å…¨èƒ½æœ¬",
                    price: 6499,
                    image_color: "#2e86de"
                },
                {
                    id: "prod_302",
                    title: "MacBook Air M2èŠ¯ç‰‡",
                    reason: "è¶…è–„è®¾è®¡ï¼ŒM2èŠ¯ç‰‡æ€§èƒ½å¼ºåŠ²ï¼Œç»­èˆªé•¿è¾¾18å°æ—¶ï¼Œé€‚åˆåŠå…¬åˆ›ä½œ",
                    price: 8999,
                    image_color: "#a4b0be"
                },
                {
                    id: "prod_303",
                    title: "æˆ´å°”çµè¶Š14 Plus",
                    reason: "12ä»£i7å¤„ç†å™¨ï¼ŒRTX3050Tiï¼Œè®¾è®¡è½»è–„æ€§èƒ½å¼ºï¼Œé€‚åˆå­¦ç”Ÿå…š",
                    price: 7299,
                    image_color: "#70a1ff"
                }
            ]
        };
        
        // é—®é¢˜æ¨èæ•°æ®ï¼ˆæŒ‰å•†å“ç±»åˆ«ï¼‰
        const questionData = {
            "è¿åŠ¨è€³æœº": [
                "è¿™æ¬¾è€³æœºçš„ç»­èˆªæ—¶é—´æœ‰å¤šé•¿ï¼Ÿ",
                "é˜²æ°´ç­‰çº§IPX4æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ",
                "é€‚åˆè·‘æ­¥æ—¶ä½©æˆ´å—ï¼Ÿ",
                "é™å™ªæ•ˆæœæ€ä¹ˆæ ·ï¼Ÿ",
                "æœ‰å“ªå‡ ç§é¢œè‰²å¯ä»¥é€‰æ‹©ï¼Ÿ",
                "å……ç”µéœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ",
                "æ”¯æŒæ— çº¿å……ç”µå—ï¼Ÿ"
            ],
            "å¤å­£è¿è¡£è£™": [
                "è¿™æ¬¾è¿è¡£è£™çš„æè´¨æ˜¯ä»€ä¹ˆï¼Ÿ",
                "é€‚åˆä»€ä¹ˆåœºåˆç©¿ç€ï¼Ÿ",
                "å°ºç æ ‡å‡†å—ï¼Ÿéœ€è¦ä¹°å¤§ä¸€ç å—ï¼Ÿ",
                "å®¹æ˜“èµ·çš±å—ï¼Ÿ",
                "é€‚åˆèº«é«˜160cmçš„äººç©¿å—ï¼Ÿ",
                "æœ‰æ²¡æœ‰å…¶ä»–é¢œè‰²å¯é€‰ï¼Ÿ",
                "æ´—æ¶¤æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"
            ],
            "ç”·å‹ç¤¼ç‰©": [
                "è¿™æ¬¾ç¤¼ç‰©æœ‰ç¤¼ç›’åŒ…è£…å—ï¼Ÿ",
                "é€‚åˆé€ç»™30å²çš„ç”·ç”Ÿå—ï¼Ÿ",
                "ä¿ä¿®æœŸæ˜¯å¤šä¹…ï¼Ÿ",
                "æœ‰æ²¡æœ‰å…¶ä»–æ¬¾å¼æ¨èï¼Ÿ",
                "é€è´§éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ",
                "æ”¯æŒåˆ»å­—æˆ–å®šåˆ¶å—ï¼Ÿ",
                "ä»·æ ¼è¿‘æœŸä¼šæœ‰ä¼˜æƒ å—ï¼Ÿ"
            ],
            "ç¬”è®°æœ¬ç”µè„‘": [
                "è¿™æ¬¾ç¬”è®°æœ¬é€‚åˆç¼–ç¨‹å—ï¼Ÿ",
                "èƒ½æµç•…è¿è¡ŒPhotoshopå—ï¼Ÿ",
                "ç”µæ± ç»­èˆªå®é™…ä½¿ç”¨å¤šä¹…ï¼Ÿ",
                "æ”¯æŒæ‰©å±•å†…å­˜å—ï¼Ÿ",
                "å±å¹•è‰²å½©æ˜¾ç¤ºå‡†ç¡®å—ï¼Ÿ",
                "æ•£çƒ­æ•ˆæœæ€ä¹ˆæ ·ï¼Ÿ",
                "æœ‰å­¦ç”Ÿä¼˜æƒ å—ï¼Ÿ"
            ],
            "default": [
                "è¿˜æœ‰å…¶ä»–æ¨èå—ï¼Ÿ",
                "è¿™äº›å•†å“æœ‰ä¼˜æƒ æ´»åŠ¨å—ï¼Ÿ",
                "é€è´§ä¸Šé—¨éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ",
                "æ”¯æŒ7å¤©æ— ç†ç”±é€€è´§å—ï¼Ÿ",
                "æ€ä¹ˆæŸ¥çœ‹å•†å“è¯¦æƒ…ï¼Ÿ",
                "å¦‚ä½•è”ç³»å®¢æœï¼Ÿ",
                "æœ‰ç”¨æˆ·è¯„ä»·å¯ä»¥å‚è€ƒå—ï¼Ÿ"
            ]
        };
        
        // çŠ¶æ€ç®¡ç†
        const state = {
            isTyping: false,
            currentTaskId: null,
            conversationId: '',
            messages: [],
            streamingInterval: null,
            currentStreamingMessageId: null,
            hasReceivedContent: false,
            isStopped: false,
            // å­˜å‚¨æ‰€æœ‰å®šæ—¶å™¨ï¼Œä¾¿äºç»Ÿä¸€æ¸…ç†
            activeTimers: []
        };
        
        // DOMå…ƒç´ 
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const stopBtn = document.getElementById('stopBtn');
        const newChatBtn = document.getElementById('newChatBtn');
        const messagesContainer = document.getElementById('messagesContainer');
        const typingIndicator = document.getElementById('typingIndicator');
        const statusIndicator = document.getElementById('statusIndicator');
        const suggestedQuestions = document.getElementById('suggestedQuestions');
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®åˆå§‹çŠ¶æ€
            updateUIState();
            
            // è¾“å…¥æ¡†äº‹ä»¶
            chatInput.addEventListener('input', function() {
                sendBtn.disabled = !this.value.trim();
            });
            
            // å‘é€æŒ‰é’®äº‹ä»¶
            sendBtn.addEventListener('click', sendMessage);
            
            // å›è½¦å‘é€ï¼ˆCtrl+Enter æ¢è¡Œï¼‰
            chatInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey && !e.ctrlKey) {
                    e.preventDefault();
                    if (!state.isTyping && this.value.trim()) {
                        sendMessage();
                    }
                }
            });
            
            // åœæ­¢æŒ‰é’®äº‹ä»¶
            stopBtn.addEventListener('click', stopResponse);
            
            // æ–°å¯¹è¯æŒ‰é’®äº‹ä»¶
            newChatBtn.addEventListener('click', startNewChat);
            
            // åˆå§‹æ¨èé—®é¢˜ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.question-chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    const question = this.textContent;
                    chatInput.value = question;
                    sendBtn.disabled = false;
                    sendMessage();
                });
            });
            
            // åé¦ˆæŒ‰é’®äº‹ä»¶
            document.addEventListener('click', function(e) {
                if (e.target.closest('.feedback-btn')) {
                    const feedbackBtn = e.target.closest('.feedback-btn');
                    const rating = feedbackBtn.getAttribute('data-rating');
                    const messageId = 'demo-message-123';
                    
                    // åˆ‡æ¢é€‰ä¸­çŠ¶æ€
                    const isActive = feedbackBtn.classList.contains('active');
                    const allBtns = feedbackBtn.parentElement.querySelectorAll('.feedback-btn');
                    allBtns.forEach(btn => btn.classList.remove('active'));
                    
                    if (!isActive) {
                        feedbackBtn.classList.add('active');
                        showNotification(`å·²${rating === 'like' ? 'ç‚¹èµ' : 'ç‚¹è¸©'}è¯¥å›å¤`);
                    } else {
                        showNotification('å·²å–æ¶ˆåé¦ˆ');
                    }
                }
            });
        });
        
        // æ·»åŠ å®šæ—¶å™¨åˆ°çŠ¶æ€ç®¡ç†
        function addTimer(timer) {
            state.activeTimers.push(timer);
            return timer;
        }
        
        // æ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨
        function clearAllTimers() {
            // æ¸…é™¤æµå¼å“åº”å®šæ—¶å™¨
            if (state.streamingInterval) {
                clearInterval(state.streamingInterval);
                state.streamingInterval = null;
            }
            
            // æ¸…é™¤æ‰€æœ‰å­˜å‚¨åœ¨activeTimersä¸­çš„å®šæ—¶å™¨
            state.activeTimers.forEach(timer => {
                if (timer) {
                    clearInterval(timer);
                    clearTimeout(timer);
                }
            });
            
            // æ¸…ç©ºå®šæ—¶å™¨æ•°ç»„
            state.activeTimers = [];
        }
        
        // åˆ›å»ºå•†å“å¡ç‰‡
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <div class="product-image" style="background-color: ${product.image_color}">
                    <!-- å®é™…å¼€å‘ä¸­è¿™é‡Œåº”è¯¥æ˜¯å•†å“å›¾ç‰‡ -->
                </div>
                <div class="product-info">
                    <div class="product-title">${product.title}</div>
                    <div class="product-reason">${product.reason}</div>
                    <div class="product-price">
                        <div class="price">${product.price}</div>
                        <button class="buy-btn">ç«‹å³è´­ä¹°</button>
                    </div>
                </div>
            `;
            
            // æ·»åŠ è´­ä¹°æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            const buyBtn = card.querySelector('.buy-btn');
            buyBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                showNotification(`å·²è·³è½¬åˆ°å•†å“ "${product.title}" çš„è´­ä¹°é¡µé¢`);
            });
            
            return card;
        }
        
        // åˆ›å»ºé—®é¢˜æ¨èèŠ¯ç‰‡
        function createQuestionChip(question) {
            const chip = document.createElement('div');
            chip.className = 'question-chip';
            chip.textContent = question;
            chip.addEventListener('click', function() {
                // ç‚¹å‡»é—®é¢˜èŠ¯ç‰‡ï¼Œè‡ªåŠ¨å‘é€æ¶ˆæ¯
                chatInput.value = question;
                sendBtn.disabled = false;
                sendMessage();
            });
            return chip;
        }
        
        // åˆå§‹åŒ–å•†å“è½®æ’­æ»‘åŠ¨åŠŸèƒ½
        function initProductCarousel(track, productCount) {
            const container = track.parentElement;
            const leftBtn = container.querySelector('.scroll-btn.left');
            const rightBtn = container.querySelector('.scroll-btn.right');
            const indicatorDots = container.nextElementSibling.querySelectorAll('.indicator-dot');
            
            const cardWidth = 215;
            const containerWidth = container.offsetWidth;
            const maxVisibleCards = Math.floor(containerWidth / cardWidth);
            let currentPosition = 0;
            let currentIndex = 0;
            const maxIndex = Math.max(0, productCount - maxVisibleCards);
            
            // æ›´æ–°æŒ‡ç¤ºå™¨
            function updateIndicator() {
                indicatorDots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === currentIndex);
                });
            }
            
            // æ»‘åŠ¨åˆ°æŒ‡å®šä½ç½®
            function scrollToPosition(position) {
                track.style.transform = `translateX(-${position}px)`;
            }
            
            // æ»‘åŠ¨åˆ°ä¸‹ä¸€å¼ 
            function scrollNext() {
                if (currentIndex < maxIndex) {
                    currentPosition += cardWidth;
                    currentIndex++;
                    scrollToPosition(currentPosition);
                    updateIndicator();
                }
            }
            
            // æ»‘åŠ¨åˆ°ä¸Šä¸€å¼ 
            function scrollPrev() {
                if (currentIndex > 0) {
                    currentPosition -= cardWidth;
                    currentIndex--;
                    scrollToPosition(currentPosition);
                    updateIndicator();
                }
            }
            
            // å·¦å³æŒ‰é’®äº‹ä»¶
            leftBtn.addEventListener('click', scrollPrev);
            rightBtn.addEventListener('click', scrollNext);
            
            // è§¦æ‘¸æ»‘åŠ¨æ”¯æŒ
            let startX = 0;
            let currentX = 0;
            let isDragging = false;
            
            track.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                currentX = startX;
                isDragging = true;
            });
            
            track.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                currentX = e.touches[0].clientX;
                const diff = startX - currentX;
                
                // è·Ÿéšæ‰‹æŒ‡ç§»åŠ¨
                track.style.transform = `translateX(-${currentPosition + diff}px)`;
            });
            
            track.addEventListener('touchend', () => {
                if (!isDragging) return;
                isDragging = false;
                
                const diff = startX - currentX;
                const threshold = 50;
                
                if (Math.abs(diff) > threshold) {
                    if (diff > 0) {
                        scrollNext();
                    } else {
                        scrollPrev();
                    }
                } else {
                    scrollToPosition(currentPosition);
                }
            });
            
            // é¼ æ ‡æ‹–åŠ¨æ”¯æŒ
            track.addEventListener('mousedown', (e) => {
                startX = e.clientX;
                currentX = startX;
                isDragging = true;
                track.style.cursor = 'grabbing';
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                currentX = e.clientX;
                const diff = startX - currentX;
                
                track.style.transform = `translateX(-${currentPosition + diff}px)`;
            });
            
            document.addEventListener('mouseup', () => {
                if (!isDragging) return;
                isDragging = false;
                track.style.cursor = 'grab';
                
                const diff = startX - currentX;
                const threshold = 50;
                
                if (Math.abs(diff) > threshold) {
                    if (diff > 0) {
                        scrollNext();
                    } else {
                        scrollPrev();
                    }
                } else {
                    scrollToPosition(currentPosition);
                }
            });
            
            // åˆå§‹æ›´æ–°æŒ‡ç¤ºå™¨
            updateIndicator();
            
            // å¦‚æœå•†å“æ•°é‡å°äºç­‰äºå¯è§æ•°é‡ï¼Œéšè—æ»‘åŠ¨æŒ‰é’®
            if (productCount <= maxVisibleCards) {
                leftBtn.style.display = 'none';
                rightBtn.style.display = 'none';
            }
        }
        
        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            const query = chatInput.value.trim();
            if (!query || state.isTyping) return;
            
            // é‡ç½®åœæ­¢æ ‡å¿—
            state.isStopped = false;
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°ç•Œé¢
            addMessage(query, 'user');
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            chatInput.value = '';
            sendBtn.disabled = true;
            
            // æ˜¾ç¤ºAIæ€è€ƒçŠ¶æ€
            state.isTyping = true;
            state.currentTaskId = 'task-' + Date.now();
            state.hasReceivedContent = false;
            
            // æ·»åŠ AIæ¶ˆæ¯å ä½ - æ˜¾ç¤º"æˆ‘æ­£åœ¨æ€è€ƒ..."
            const aiMessageId = addMessage('', 'assistant', true);
            state.currentStreamingMessageId = aiMessageId;
            
            // æ›´æ–°UIçŠ¶æ€
            updateUIState();
            
            // æ¨¡æ‹ŸAPIè°ƒç”¨
            simulateAPICall(query, aiMessageId);
            
            // éšè—åˆå§‹æ¨èé—®é¢˜ï¼ˆåªåœ¨ç¬¬ä¸€æ¬¡å¯¹è¯åéšè—ï¼‰
            if (state.messages.length === 2) {
                suggestedQuestions.style.display = 'none';
            }
        }
        
        // æ¨¡æ‹ŸAPIè°ƒç”¨å’Œæµå¼å“åº”
        function simulateAPICall(query, aiMessageId) {
            // æ£€æµ‹æŸ¥è¯¢ç±»å‹ï¼Œç¡®å®šæ˜¯å¦æ˜¾ç¤ºå•†å“æ¨è
            let queryType = "default";
            let showProducts = false;
            let productCategory = "";
            
            if (query.includes("è€³æœº") || query.includes("è€³éº¦") || query.includes("è¿åŠ¨è€³æœº")) {
                queryType = "è¿åŠ¨è€³æœº";
                showProducts = true;
                productCategory = "è¿åŠ¨è€³æœº";
            } else if (query.includes("è¿è¡£è£™") || query.includes("è£™å­") || query.includes("å¤å­£")) {
                queryType = "å¤å­£è¿è¡£è£™";
                showProducts = true;
                productCategory = "å¤å­£è¿è¡£è£™";
            } else if (query.includes("ç¤¼ç‰©") || query.includes("é€ç¤¼") || query.includes("ç”·å‹")) {
                queryType = "ç”·å‹ç¤¼ç‰©";
                showProducts = true;
                productCategory = "ç”·å‹ç¤¼ç‰©";
            } else if (query.includes("ç¬”è®°æœ¬") || query.includes("ç”µè„‘") || query.includes("æ€§ä»·æ¯”")) {
                queryType = "ç¬”è®°æœ¬ç”µè„‘";
                showProducts = true;
                productCategory = "ç¬”è®°æœ¬ç”µè„‘";
            }
            
            // æ¨¡æ‹Ÿæµå¼å“åº”å†…å®¹
            const responses = {
                "è¿åŠ¨è€³æœº": [
                    "ä¸ºæ‚¨æ¨èå‡ æ¬¾é€‚åˆè¿åŠ¨æ—¶ä½©æˆ´çš„æ— çº¿è€³æœºï¼Œå®ƒä»¬å…·æœ‰é˜²æ°´é˜²æ±—ã€ä½©æˆ´ç¨³å›ºçš„ç‰¹ç‚¹ï¼š"
                ],
                "å¤å­£è¿è¡£è£™": [
                    "ä¸ºæ‚¨æ¨èå‡ æ¬¾é€‚åˆå¤å­£ç©¿ç€çš„è¿è¡£è£™ï¼Œæè´¨é€æ°”ï¼Œè®¾è®¡æ—¶å°šï¼š"
                ],
                "ç”·å‹ç¤¼ç‰©": [
                    "ä¸ºæ‚¨æ¨èå‡ æ¬¾é€‚åˆé€ç»™ç”·å‹çš„ç¤¼ç‰©ï¼Œæ—¢å®ç”¨åˆæœ‰é¢å­ï¼š"
                ],
                "ç¬”è®°æœ¬ç”µè„‘": [
                    "ä¸ºæ‚¨æ¨èå‡ æ¬¾æ€§ä»·æ¯”é«˜çš„ç¬”è®°æœ¬ç”µè„‘ï¼Œæ»¡è¶³ä¸åŒéœ€æ±‚ï¼š"
                ],
                "default": [
                    "æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ä¸ºæ‚¨æ•´ç†äº†ä»¥ä¸‹ä¿¡æ¯ï¼š"
                ]
            };
            
            // æ ¹æ®é—®é¢˜é€‰æ‹©å“åº”å†…å®¹
            let responseParts = responses[queryType] || responses["default"];
            
            // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿï¼Œè®©ç”¨æˆ·çœ‹åˆ°"æˆ‘æ­£åœ¨æ€è€ƒ..."
            const initialDelayTimer = setTimeout(() => {
                // æ£€æŸ¥æ˜¯å¦å·²åœæ­¢
                if (state.isStopped) return;
                
                // å¼€å§‹æµå¼æ˜¾ç¤º
                let currentPartIndex = 0;
                let currentCharIndex = 0;
                const aiMessageElement = document.getElementById(aiMessageId);
                
                // è®¾ç½®æµå¼å“åº”å®šæ—¶å™¨
                state.streamingInterval = setInterval(() => {
                    // æ£€æŸ¥æ˜¯å¦å·²åœæ­¢
                    if (state.isStopped) {
                        clearInterval(state.streamingInterval);
                        state.streamingInterval = null;
                        return;
                    }
                    
                    if (currentPartIndex >= responseParts.length) {
                        // æµå¼å“åº”å®Œæˆ
                        clearInterval(state.streamingInterval);
                        state.streamingInterval = null;
                        
                        // æ›´æ–°çŠ¶æ€ï¼šå·²æ”¶åˆ°å†…å®¹
                        state.hasReceivedContent = true;
                        
                        // æ£€æŸ¥æ˜¯å¦å·²åœæ­¢
                        if (state.isStopped) return;
                        
                        // å¦‚æœéœ€è¦æ˜¾ç¤ºå•†å“æ¨èï¼Œæ·»åŠ åˆ°æ¶ˆæ¯ä¸­
                        if (showProducts && productCategory) {
                            const productTimer = setTimeout(() => {
                                // æ£€æŸ¥æ˜¯å¦å·²åœæ­¢
                                if (state.isStopped) return;
                                addProductRecommendations(aiMessageId, productCategory);
                            }, 300);
                            addTimer(productTimer);
                        } else {
                            // å¦‚æœæ²¡æœ‰å•†å“æ¨èï¼Œç›´æ¥æ˜¾ç¤ºé—®é¢˜æ¨è
                            const questionTimer = setTimeout(() => {
                                // æ£€æŸ¥æ˜¯å¦å·²åœæ­¢
                                if (state.isStopped) return;
                                addQuestionRecommendations(aiMessageId, productCategory || "default");
                            }, 300);
                            addTimer(questionTimer);
                        }
                        
                        return;
                    }
                    
                    const currentPart = responseParts[currentPartIndex];
                    
                    if (currentCharIndex < currentPart.length) {
                        // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œæ¸…é™¤"æˆ‘æ­£åœ¨æ€è€ƒ..."æç¤º
                        if (!state.hasReceivedContent && currentCharIndex === 0) {
                            state.hasReceivedContent = true;
                            // æ¸…é™¤æ€è€ƒæç¤º
                            const thinkingIndicator = aiMessageElement.querySelector('.thinking-indicator');
                            if (thinkingIndicator) {
                                thinkingIndicator.remove();
                            }
                            aiMessageElement.innerHTML = '';
                        }
                        
                        // é€å­—æ·»åŠ 
                        aiMessageElement.textContent += currentPart[currentCharIndex];
                        currentCharIndex++;
                        
                        // æ»šåŠ¨åˆ°åº•éƒ¨
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    } else {
                        // å½“å‰éƒ¨åˆ†å®Œæˆï¼Œè½¬åˆ°ä¸‹ä¸€éƒ¨åˆ†
                        currentPartIndex++;
                        currentCharIndex = 0;
                    }
                }, 30);
                
                addTimer(state.streamingInterval);
            }, 1500); // æ¨¡æ‹Ÿ1.5ç§’ç½‘ç»œå»¶è¿Ÿ
            
            addTimer(initialDelayTimer);
        }
        
        // æ·»åŠ å•†å“æ¨èåˆ°æ¶ˆæ¯
        function addProductRecommendations(messageId, category) {
            // æ£€æŸ¥æ˜¯å¦å·²åœæ­¢
            if (state.isStopped) return;
            
            const messageElement = document.getElementById(`message-${messageId}`);
            const messageContent = messageElement.querySelector('.message-content');
            
            // è·å–å•†å“æ•°æ®
            const products = productData[category] || productData["è¿åŠ¨è€³æœº"];
            
            // åˆ›å»ºå•†å“æ¨èåŒºåŸŸ
            const recommendationsDiv = document.createElement('div');
            recommendationsDiv.className = 'product-recommendations';
            recommendationsDiv.innerHTML = `
                <div class="recommendation-title">ä¸ºæ‚¨ç²¾é€‰${category}æ¨è</div>
                <div class="product-cards-container">
                    <button class="scroll-btn left">â€¹</button>
                    <button class="scroll-btn right">â€º</button>
                    <div class="product-cards-track">
                        <!-- å•†å“å¡ç‰‡ä¼šåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
                <div class="scroll-indicator">
                    <!-- æŒ‡ç¤ºå™¨ç‚¹ä¼šæ ¹æ®å•†å“æ•°é‡åŠ¨æ€æ·»åŠ  -->
                </div>
            `;
            
            const productCardsTrack = recommendationsDiv.querySelector('.product-cards-track');
            const scrollIndicator = recommendationsDiv.querySelector('.scroll-indicator');
            
            // æ·»åŠ å•†å“å¡ç‰‡
            products.forEach(product => {
                const productCard = createProductCard(product);
                productCardsTrack.appendChild(productCard);
            });
            
            // æ·»åŠ æ»‘åŠ¨æŒ‡ç¤ºå™¨
            const dotCount = Math.min(products.length, 5);
            for (let i = 0; i < dotCount; i++) {
                const dot = document.createElement('div');
                dot.className = 'indicator-dot' + (i === 0 ? ' active' : '');
                scrollIndicator.appendChild(dot);
            }
            
            // å°†å•†å“æ¨èåŒºåŸŸæ·»åŠ åˆ°æ¶ˆæ¯å†…å®¹ä¸­
            const feedbackButtons = messageContent.querySelector('.feedback-buttons');
            if (!feedbackButtons) {
                const feedbackDiv = document.createElement('div');
                feedbackDiv.className = 'feedback-buttons';
                feedbackDiv.innerHTML = `
                    <button class="feedback-btn" data-rating="like">ğŸ‘</button>
                    <button class="feedback-btn dislike" data-rating="dislike">ğŸ‘</button>
                `;
                messageContent.appendChild(recommendationsDiv);
                messageContent.appendChild(feedbackDiv);
            } else {
                messageContent.insertBefore(recommendationsDiv, feedbackButtons);
            }
            
            // åˆå§‹åŒ–æ»‘åŠ¨åŠŸèƒ½
            const carouselTimer = setTimeout(() => {
                // æ£€æŸ¥æ˜¯å¦å·²åœæ­¢
                if (state.isStopped) return;
                initProductCarousel(productCardsTrack, products.length);
            }, 100);
            addTimer(carouselTimer);
            
            // æ›´æ–°æ¶ˆæ¯å†…å®¹ï¼Œç§»é™¤æµå¼çŠ¶æ€
            const aiMessageElement = document.getElementById(messageId);
            if (aiMessageElement) {
                aiMessageElement.style.fontStyle = 'normal';
                aiMessageElement.style.color = '#1d1d1f';
            }
            
            // åœ¨å•†å“æ¨èä¹‹åæ·»åŠ é—®é¢˜æ¨è
            const questionTimer = setTimeout(() => {
                // æ£€æŸ¥æ˜¯å¦å·²åœæ­¢
                if (state.isStopped) return;
                addQuestionRecommendations(messageId, category);
            }, 500);
            addTimer(questionTimer);
        }
        
        // æ·»åŠ é—®é¢˜æ¨èåˆ°æ¶ˆæ¯
        function addQuestionRecommendations(messageId, category) {
            // æ£€æŸ¥æ˜¯å¦å·²åœæ­¢
            if (state.isStopped) return;
            
            const messageElement = document.getElementById(`message-${messageId}`);
            if (!messageElement) return;
            
            const messageContent = messageElement.querySelector('.message-content');
            if (!messageContent) return;
            
            // è·å–é—®é¢˜æ•°æ®
            const questions = questionData[category] || questionData["default"];
            
            // éšæœºé€‰æ‹©3-5ä¸ªé—®é¢˜
            const shuffledQuestions = [...questions].sort(() => 0.5 - Math.random());
            const selectedQuestions = shuffledQuestions.slice(0, Math.min(5, questions.length));
            
            // åˆ›å»ºé—®é¢˜æ¨èåŒºåŸŸ
            const questionRecommendationsDiv = document.createElement('div');
            questionRecommendationsDiv.className = 'question-recommendations';
            questionRecommendationsDiv.innerHTML = `
                <div class="question-title">æ‚¨è¿˜å¯ä»¥é—®æˆ‘è¿™äº›é—®é¢˜ï¼š</div>
                <div class="question-chips-container">
                    <!-- é—®é¢˜èŠ¯ç‰‡ä¼šåŠ¨æ€æ·»åŠ  -->
                </div>
            `;
            
            const questionChipsContainer = questionRecommendationsDiv.querySelector('.question-chips-container');
            
            // æ·»åŠ é—®é¢˜èŠ¯ç‰‡
            selectedQuestions.forEach(question => {
                const questionChip = createQuestionChip(question);
                questionChipsContainer.appendChild(questionChip);
            });
            
            // å°†é—®é¢˜æ¨èåŒºåŸŸæ·»åŠ åˆ°æ¶ˆæ¯å†…å®¹ä¸­ï¼ˆåœ¨åé¦ˆæŒ‰é’®ä¹‹å‰ï¼‰
            const feedbackButtons = messageContent.querySelector('.feedback-buttons');
            if (feedbackButtons) {
                messageContent.insertBefore(questionRecommendationsDiv, feedbackButtons);
            } else {
                messageContent.appendChild(questionRecommendationsDiv);
            }
            
            // æ›´æ–°çŠ¶æ€
            state.isTyping = false;
            state.currentTaskId = null;
            state.currentStreamingMessageId = null;
            updateUIState();
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            const scrollTimer = setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 200);
            addTimer(scrollTimer);
        }
        
        // åœæ­¢å›å¤
        function stopResponse() {
            // è®¾ç½®åœæ­¢æ ‡å¿—
            state.isStopped = true;
            
            // æ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨
            clearAllTimers();
            
            // å¦‚æœæœ‰æ­£åœ¨æµå¼å“åº”çš„æ¶ˆæ¯ï¼Œæ˜¾ç¤ºåœæ­¢æç¤º
            if (state.currentStreamingMessageId) {
                const aiMessageElement = document.getElementById(state.currentStreamingMessageId);
                if (aiMessageElement) {
                    // æ¸…é™¤æ‰€æœ‰å†…å®¹
                    aiMessageElement.innerHTML = '';
                    
                    // æ·»åŠ åœæ­¢æç¤º
                    const stopHint = document.createElement('div');
                    stopHint.className = 'stop-hint';
                    stopHint.textContent = 'å¥½çš„ï¼Œé‚£å…ˆä¸è§£ç­”äº†ï¼Œä½ å¯ä»¥ç»§ç»­å‘æˆ‘æé—®å“¦';
                    
                    aiMessageElement.appendChild(stopHint);
                    
                    // æ›´æ–°æ¶ˆæ¯æ ·å¼
                    aiMessageElement.style.fontStyle = 'normal';
                    aiMessageElement.style.color = '#1d1d1f';
                }
            }
            
            // æ˜¾ç¤ºåˆå§‹æ¨èé—®é¢˜ï¼Œå¼•å¯¼ç”¨æˆ·ç»§ç»­æé—®
            suggestedQuestions.style.display = 'block';
            
            // æ›´æ–°çŠ¶æ€
            state.isTyping = false;
            state.currentTaskId = null;
            state.currentStreamingMessageId = null;
            state.hasReceivedContent = false;
            
            showNotification('å·²åœæ­¢AIç”Ÿæˆ');
            updateUIState();
        }
        
        // å¼€å§‹æ–°å¯¹è¯
        function startNewChat() {
            if (state.isTyping) {
                if (!confirm('AIæ­£åœ¨æ€è€ƒä¸­ï¼Œç¡®å®šè¦å¼€å§‹æ–°å¯¹è¯å—ï¼Ÿ')) {
                    return;
                }
                stopResponse();
            }
            
            // æ¸…ç©ºæ¶ˆæ¯å®¹å™¨ï¼ˆä¿ç•™ç¬¬ä¸€æ¡æ¬¢è¿æ¶ˆæ¯ï¼‰
            const messages = messagesContainer.querySelectorAll('.message');
            for (let i = 1; i < messages.length; i++) {
                messages[i].remove();
            }
            
            // é‡ç½®çŠ¶æ€
            state.conversationId = '';
            state.messages = [];
            state.currentStreamingMessageId = null;
            state.hasReceivedContent = false;
            state.isStopped = false;
            
            // æ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨
            clearAllTimers();
            
            // æ˜¾ç¤ºåˆå§‹æ¨èé—®é¢˜
            suggestedQuestions.style.display = 'block';
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification('å·²å¼€å§‹æ–°å¯¹è¯');
            
            // æ·»åŠ æ¬¢è¿æ¶ˆæ¯ï¼ˆå¦‚æœå·²åˆ é™¤ï¼‰
            if (messages.length === 0) {
                addMessage('ä½ å¥½å‘€ï¼Œæˆ‘æ˜¯æ‚¨çš„ä¸‰ç¦å¯¼è´­å°å¸®æ‰‹ï¼Œä¸“æ³¨äºå¸®åŠ©æ‚¨å¿«é€Ÿæ‰¾åˆ°å¿ƒä»ªçš„å•†å“ï¼ŒåŒæ—¶æä¾›ä¸ªæ€§åŒ–çš„æ¨èå’Œè½»æ¾æ„‰å¿«çš„äº¤æµã€‚æ— è®ºæ‚¨æ˜¯åœ¨å¯»æ‰¾ç‰¹å®šäº§å“ï¼Œè¿˜æ˜¯éœ€è¦ä¸€äº›é—²é€›è´­ç‰©çš„å»ºè®®ï¼Œæˆ‘éƒ½ä¼šåŠªåŠ›æä¾›æœ€ç›¸å…³å’Œå®ç”¨çš„ä¿¡æ¯ã€‚ä¸è®ºæ‚¨æœ‰ä»€ä¹ˆè¦æ±‚æˆ–é—®é¢˜ï¼Œéƒ½æ¬¢è¿éšæ—¶æé—®ï¼', 'assistant');
            }
        }
        
        // æ·»åŠ æ¶ˆæ¯åˆ°ç•Œé¢
        function addMessage(content, role, isStreaming = false) {
            const messageId = 'msg-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            messageDiv.id = `message-${messageId}`;
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'avatar';
            avatarDiv.textContent = role === 'user' ? 'æ‚¨' : 'AI';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            const textDiv = document.createElement('div');
            textDiv.className = 'message-text';
            textDiv.id = isStreaming ? messageId : undefined;
            
            if (!isStreaming) {
                textDiv.textContent = content;
            } else {
                // æµå¼æ¶ˆæ¯æ·»åŠ æ€è€ƒæç¤º
                const thinkingDiv = document.createElement('div');
                thinkingDiv.className = 'thinking-indicator';
                thinkingDiv.innerHTML = `
                    æˆ‘æ­£åœ¨æ€è€ƒ<span class="thinking-dot"></span><span class="thinking-dot"></span><span class="thinking-dot"></span>
                `;
                textDiv.appendChild(thinkingDiv);
                
                textDiv.style.fontStyle = 'italic';
                textDiv.style.color = '#666';
            }
            
            contentDiv.appendChild(textDiv);
            
            // åªæœ‰AIæ¶ˆæ¯æ˜¾ç¤ºåé¦ˆæŒ‰é’®
            if (role === 'assistant' && !isStreaming) {
                const feedbackDiv = document.createElement('div');
                feedbackDiv.className = 'feedback-buttons';
                feedbackDiv.innerHTML = `
                    <button class="feedback-btn" data-rating="like">ğŸ‘</button>
                    <button class="feedback-btn dislike" data-rating="dislike">ğŸ‘</button>
                `;
                contentDiv.appendChild(feedbackDiv);
            }
            
            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(contentDiv);
            
            messagesContainer.appendChild(messageDiv);
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // æ·»åŠ åˆ°çŠ¶æ€
            state.messages.push({
                id: messageId,
                role: role,
                content: content,
                isStreaming: isStreaming
            });
            
            return messageId;
        }
        
        // æ›´æ–°UIçŠ¶æ€
        function updateUIState() {
            // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
            if (state.isTyping) {
                statusIndicator.textContent = 'AIæ€è€ƒä¸­...';
                statusIndicator.className = 'status typing';
                typingIndicator.style.display = 'flex';
            } else {
                statusIndicator.textContent = 'å‡†å¤‡å°±ç»ª';
                statusIndicator.className = 'status idle';
                typingIndicator.style.display = 'none';
            }
            
            // æ˜¾ç¤º/éšè—åœæ­¢æŒ‰é’®
            if (state.isTyping) {
                stopBtn.classList.add('show');
            } else {
                stopBtn.classList.remove('show');
            }
            
            // æ›´æ–°å‘é€æŒ‰é’®çŠ¶æ€
            sendBtn.disabled = state.isTyping || !chatInput.value.trim();
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: #007aff;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 1000;
                animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
                animation-fill-mode: forwards;
                font-size: 14px;
                max-width: 300px;
            `;
            
            document.body.appendChild(notification);
            
            // 3ç§’åç§»é™¤
            const removeTimer = setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
            
            addTimer(removeTimer);
            
            // æ·»åŠ åŠ¨ç”»æ ·å¼
            if (!document.querySelector('#notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes fadeOut {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }
    </script>
</body>
</html>
